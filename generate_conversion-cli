#!/bin/bash

clear
cmd=""

remove_task() {
  local task_option="$1"
  index=0
  for i in "${!tasks[@]}"; do
    if [[ "${tasks[i]}" == "$task_option" ]]; then
      index=$i
      break
    fi
  done
  unset "tasks[$index]"
  tasks=("${tasks[@]}")  # Remove empty placeholders
}

langs=('English (en)' 'French (fr)')
select lang_option in "${langs[@]}"; do
  case $lang_option in
    'English (en)')
      lang='en'
      break
      ;;
    'French (fr)')
      lang='fr'
      break
      ;;
    *)
      echo 'Invalid option'
      exit 1
      ;;
  esac
done

clear

tasks=('Ocr to correcte text' 'Paraphrase text for beginner' 'pass')

need_more_task=true
while $need_more_task;do
  if [ ${#tasks[@]} -le 1  ];then
    break
  fi
  select task_option in "${tasks[@]}" ; do
    case $task_option in
      'Ocr to correcte text')
        task+='--llm correct_ocr '
        remove_task "$task_option"
        break
        ;;
      'Paraphrase text for beginner')
        task+='--llm correct_ocr '
        remove_task "$task_option"
        break
        ;;
      'pass')
        need_more_task=false
        if [ -z "$task" ];then
          echo "We should provide at least one task"
          exit 1
        fi
        break
        ;;
      *)
        echo 'Invalid option'
        exit 1
        ;;
    esac
  done
done

# exit 1
clear
# exit 1

file="${1:-/tmp/1.pdf}"
output="file.md"

cmd=""
cmd+="CONVERSION=false\n"
cmd+="\n"
cmd+="if python3 llmtask.py "
cmd+="--lang $lang "
cmd+="--ocr /usr/bin/tesseract "
cmd+="$task "
cmd+="--file $file "
cmd+="1>$output"
cmd+="; then\n"
cmd+="    CONVERSION=false\n"
cmd+="    echo \"some errors\"\n"
cmd+="fi"

echo -e "$cmd"
